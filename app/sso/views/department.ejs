<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>

<head>
    <% include includes/meta.ejs %> 
    <!--/meta 作为公共模版分离出去-->
    <title>悉道SSO权限管理后台</title>
</head>

<body>
    <div class="text-c" style="margin-top:50px"> 
        <input type="text" name="keyword" id="inputtext" style="width:500px;height:100px;" class="input-text">
        <button name="" id="button1" class="btn btn-success" type="button" onclick="gettoken()"><i class="Hui-iconfont">&#xe665;</i>button1</button>
        <button name="" id="button2" class="btn btn-success" type="button" onclick="getbumen()"><i class="Hui-iconfont">&#xe665;</i>button2</button>
    </div>
    <div class="text-c" style="margin-top:50px">
            <ul id="treeDemo" class="ztree"></ul>
    </div>
    <% include includes/footer.ejs %>
    <script type="text/javascript">
        function gettoken(){
            $.ajax({
                type: 'GET',
                url: '/cdo/sso/gettoken',
                data:{
                    corpid:'ding865f2022dc64284135c2f4657eb6378f',
                    corpsecret:'Bo67en-DR4aBMYHV-BczWlIWiFFa_aAla5kZbyc9JGwcHs6g2K2TWrtbZ1GWWqIH'
                },
                dataType: 'json',
                success: function(data){
                    var jsonObj=eval("("+data+")");
                    $("#inputtext").val(jsonObj.access_token);
                },
                error:function(data) {
                    console.log(data);
                },
            });
    }


    var setting = {
        view: {
            dblClickExpand: false,
            showLine: false,
            selectedMulti: false
        },
        data: {
            simpleData: {
                enable:true,
                idKey: "id",
                pIdKey: "pId",
                rootPId: ""
            }
        },
        callback: {
            beforeClick: function(treeId, treeNode) {
                var zTree = $.fn.zTree.getZTreeObj("treeDemo");
                var ids= treeNode.isParent;
                if(!treeNode.isParent){
                    // treeNode.url = "/material/supply/list";
                    //获取点击节点的id
                    var id = treeNode.id;
                    
                }

                
            }
        }
    };

    function getbumen(){
            $.ajax({
                type: 'GET',
                url: '/cdo/sso/department/list',
                data:{
                    access_token:$("#inputtext").val()
                },
                dataType: 'json',
                success: function(data){
                    $("#inputtext").val(data);

                    //形成数
                    var t = $("#treeDemo");
                    //取zNodes
                    var zNodes = [];
                    var jsonObj=eval("("+data+")");
                    $.each(jsonObj.department, function (i, item) {  
                            var obj = new Object;
                            obj.id = item.id;
                            obj.pId = item.parentid;
                            obj.name = item.name;
                            zNodes.push(obj);
                        });

                    t = $.fn.zTree.init(t, setting, zNodes);
                    var zTree = $.fn.zTree.getZTreeObj("treeDemo");
                    zTree.expandAll(true);


                },
                error:function(data) {
                    console.log(data);
                },
            });
    }
    </script>
</body>

</html>